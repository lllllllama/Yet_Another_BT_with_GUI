# Yet-Another-BT ä½¿ç”¨æ–‡æ¡£

## ğŸ“– ç›®å½•

- [é¡¹ç›®ç®€ä»‹](#é¡¹ç›®ç®€ä»‹)
- [ç¯å¢ƒè¦æ±‚](#ç¯å¢ƒè¦æ±‚)
- [ç¼–è¯‘æŒ‡å—](#ç¼–è¯‘æŒ‡å—)
- [è¿è¡Œæ–¹æ³•](#è¿è¡Œæ–¹æ³•)
- [ä½¿ç”¨ç¤ºä¾‹](#ä½¿ç”¨ç¤ºä¾‹)
- [ç¨‹åºè¾“å‡ºè¯´æ˜](#ç¨‹åºè¾“å‡ºè¯´æ˜)
- [æ–­ç‚¹ç»­ä¼ ](#æ–­ç‚¹ç»­ä¼ )
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)
- [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)

---

## é¡¹ç›®ç®€ä»‹

Yet-Another-BT æ˜¯ä¸€ä¸ªä½¿ç”¨ C è¯­è¨€å®ç°çš„å‘½ä»¤è¡Œ BitTorrent ä¸‹è½½å®¢æˆ·ç«¯ã€‚å®ƒå®ç°äº† BitTorrent åè®®çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œå¯ä»¥è§£æç§å­æ–‡ä»¶å¹¶ä» P2P ç½‘ç»œä¸‹è½½æ–‡ä»¶ã€‚

### æ”¯æŒçš„åŠŸèƒ½

- âœ… è§£æ `.torrent` ç§å­æ–‡ä»¶
- âœ… ä¸ Tracker æœåŠ¡å™¨é€šä¿¡
- âœ… ä¸å…¶ä»– Peer äº¤æ¢æ•°æ®
- âœ… æ”¯æŒå•æ–‡ä»¶å’Œå¤šæ–‡ä»¶ç§å­
- âœ… æ–­ç‚¹ç»­ä¼ åŠŸèƒ½
- âœ… SHA1 æ•°æ®æ ¡éªŒ

---

## ç¯å¢ƒè¦æ±‚

### æ“ä½œç³»ç»Ÿ

| ç³»ç»Ÿ | æ”¯æŒçŠ¶æ€ |
|------|---------|
| Linux (Ubuntu/CentOS/Debian ç­‰) | âœ… å®Œå…¨æ”¯æŒ |
| macOS | âœ… æ”¯æŒ |
| Windows | âŒ ä¸æ”¯æŒ (ä½¿ç”¨äº† POSIX API) |

### ä¾èµ–é¡¹

#### Linux ç³»ç»Ÿ

```bash
# Ubuntu/Debian
sudo apt-get update
sudo apt-get install build-essential libssl-dev

# CentOS/RHEL
sudo yum groupinstall "Development Tools"
sudo yum install openssl-devel

# Fedora
sudo dnf groupinstall "Development Tools"
sudo dnf install openssl-devel
```

#### macOS ç³»ç»Ÿ

```bash
# å®‰è£… Xcode å‘½ä»¤è¡Œå·¥å…·
xcode-select --install

# å¦‚æœä½¿ç”¨ Homebrewï¼Œå¯é€‰å®‰è£… OpenSSL
brew install openssl
```

### ç¼–è¯‘å·¥å…·è¦æ±‚

- **GCC**: ç‰ˆæœ¬ 4.0 æˆ–æ›´é«˜
- **Make**: GNU Make
- **OpenSSL**: libssl-dev (Linux) æˆ– CommonCrypto (macOS)

---

## ç¼–è¯‘æŒ‡å—

### 1. è·å–æºä»£ç 

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /path/to/yet-another-bt
```

### 2. ç¼–è¯‘é¡¹ç›®

```bash
# ä½¿ç”¨ make å‘½ä»¤ç¼–è¯‘
make
```

ç¼–è¯‘æˆåŠŸåï¼Œä¼šåœ¨å½“å‰ç›®å½•ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ `ttorrent`ã€‚

### 3. éªŒè¯ç¼–è¯‘ç»“æœ

```bash
# æ£€æŸ¥å¯æ‰§è¡Œæ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -la ttorrent

# è¾“å‡ºç¤ºä¾‹ï¼š
# -rwxr-xr-x 1 user user 45678 Dec 15 10:00 ttorrent
```

### 4. æ¸…ç†ç¼–è¯‘äº§ç‰©

```bash
# åˆ é™¤æ‰€æœ‰ç¼–è¯‘ç”Ÿæˆçš„æ–‡ä»¶
make clean
```

### ç¼–è¯‘é€‰é¡¹è¯´æ˜

Makefile ä¸­å®šä¹‰çš„ç¼–è¯‘é€‰é¡¹ï¼š

| é€‰é¡¹ | è¯´æ˜ |
|------|------|
| `-Wall` | å¼€å¯æ‰€æœ‰è­¦å‘Š |
| `-g` | ç”Ÿæˆè°ƒè¯•ä¿¡æ¯ |
| `-DDEBUG` | å¯ç”¨è°ƒè¯•æ¨¡å¼ |
| `-ldl` | é“¾æ¥åŠ¨æ€åŠ è½½åº“ |

å¦‚éœ€ä¿®æ”¹ç¼–è¯‘é€‰é¡¹ï¼Œå¯ç¼–è¾‘ `Makefile` æ–‡ä»¶ã€‚

---

## è¿è¡Œæ–¹æ³•

### åŸºæœ¬è¯­æ³•

```bash
./ttorrent <ç§å­æ–‡ä»¶è·¯å¾„>
```

### å‚æ•°è¯´æ˜

| å‚æ•° | å¿…éœ€ | è¯´æ˜ |
|------|------|------|
| `<ç§å­æ–‡ä»¶è·¯å¾„>` | æ˜¯ | .torrent ç§å­æ–‡ä»¶çš„è·¯å¾„ |

### è¿è¡Œå‰å‡†å¤‡

1. ç¡®ä¿ç§å­æ–‡ä»¶æœ‰æ•ˆä¸”å¯è¯»
2. ç¡®ä¿æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´
3. ç¡®ä¿ç½‘ç»œè¿æ¥æ­£å¸¸
4. ç¡®ä¿ Tracker æœåŠ¡å™¨å¯è®¿é—®

---

## ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1: ä¸‹è½½å•ä¸ªæ–‡ä»¶

```bash
# ä¸‹è½½ä¸€ä¸ª Linux ISO é•œåƒ
./ttorrent ubuntu-22.04-desktop-amd64.iso.torrent
```

### ç¤ºä¾‹ 2: ä¸‹è½½å¤šæ–‡ä»¶ç§å­

```bash
# ä¸‹è½½åŒ…å«å¤šä¸ªæ–‡ä»¶çš„ç§å­
./ttorrent my-files.torrent
```

### ç¤ºä¾‹ 3: åå°è¿è¡Œ

```bash
# ä½¿ç”¨ nohup åœ¨åå°è¿è¡Œ
nohup ./ttorrent large-file.torrent > download.log 2>&1 &

# æŸ¥çœ‹ä¸‹è½½æ—¥å¿—
tail -f download.log
```

### ç¤ºä¾‹ 4: ä½¿ç”¨ç»å¯¹è·¯å¾„

```bash
./ttorrent /home/user/torrents/example.torrent
```

---

## ç¨‹åºè¾“å‡ºè¯´æ˜

### å¯åŠ¨æ—¶çš„è¾“å‡º

```
after parse files          # ç§å­æ–‡ä»¶è§£æå®Œæˆ
after peers files          # Peer åˆ—è¡¨åˆå§‹åŒ–å®Œæˆ
after create files         # ä¸‹è½½æ–‡ä»¶åˆ›å»ºå®Œæˆ
after create bitfield      # ä½å›¾åˆ›å»ºå®Œæˆ
after create btcache       # æ•°æ®ç¼“å†²åŒºåˆ›å»ºå®Œæˆ
```

### ä¸‹è½½è¿‡ç¨‹ä¸­çš„è¾“å‡º

ç¨‹åºä¼šå®šæœŸæ˜¾ç¤ºä¸‹è½½è¿›åº¦ä¿¡æ¯ï¼š

```
ä¸‹è½½è¿›åº¦: 45.2%
ä¸‹è½½é€Ÿåº¦: 1.5 MB/s
å·²è¿æ¥ Peer æ•°: 8
```

### æ­£å¸¸é€€å‡º

æŒ‰ `Ctrl+C` å¯ä»¥å®‰å…¨é€€å‡ºç¨‹åºï¼š

```
Please wait for clear operations
```

ç¨‹åºä¼šè‡ªåŠ¨ï¼š
1. ä¿å­˜å½“å‰ä¸‹è½½è¿›åº¦ï¼ˆä½å›¾ï¼‰
2. å…³é—­æ‰€æœ‰ç½‘ç»œè¿æ¥
3. é‡Šæ”¾å†…å­˜èµ„æº

---

## æ–­ç‚¹ç»­ä¼ 

### å·¥ä½œåŸç†

ç¨‹åºä½¿ç”¨ä½å›¾æ–‡ä»¶è®°å½•å·²ä¸‹è½½çš„æ•°æ®å—ã€‚ä½å›¾æ–‡ä»¶åæ ¼å¼ä¸ºï¼š

```
<pieces_length>_bitmap
```

ä¾‹å¦‚ï¼š`20480_bitmap`

### ä½¿ç”¨æ–¹æ³•

1. **é¦–æ¬¡ä¸‹è½½**ï¼šæ­£å¸¸å¯åŠ¨ç¨‹åº
2. **ä¸­æ–­ä¸‹è½½**ï¼šæŒ‰ `Ctrl+C` æˆ–ç¨‹åºå¼‚å¸¸é€€å‡º
3. **æ¢å¤ä¸‹è½½**ï¼šå†æ¬¡è¿è¡Œç›¸åŒå‘½ä»¤ï¼Œç¨‹åºä¼šè‡ªåŠ¨æ£€æµ‹ä½å›¾æ–‡ä»¶å¹¶æ¢å¤è¿›åº¦

### æ³¨æ„äº‹é¡¹

- ä½å›¾æ–‡ä»¶ä¿å­˜åœ¨å½“å‰å·¥ä½œç›®å½•
- ä¸è¦ç§»åŠ¨æˆ–åˆ é™¤ä½å›¾æ–‡ä»¶
- ä¸è¦ä¿®æ”¹ç§å­æ–‡ä»¶
- ç¡®ä¿ä¸‹è½½æ–‡ä»¶æœªè¢«ç§»åŠ¨

### é‡æ–°å¼€å§‹ä¸‹è½½

å¦‚éœ€é‡æ–°å¼€å§‹ä¸‹è½½ï¼ˆæ”¾å¼ƒå·²ä¸‹è½½çš„è¿›åº¦ï¼‰ï¼š

```bash
# åˆ é™¤ä½å›¾æ–‡ä»¶
rm -f *_bitmap

# åˆ é™¤å·²ä¸‹è½½çš„æ–‡ä»¶ï¼ˆå¦‚æœéœ€è¦ï¼‰
rm -rf <ä¸‹è½½çš„æ–‡ä»¶æˆ–ç›®å½•>

# é‡æ–°å¼€å§‹ä¸‹è½½
./ttorrent your-file.torrent
```

---

## å¸¸è§é—®é¢˜

### Q1: ç¼–è¯‘æ—¶æç¤ºæ‰¾ä¸åˆ° openssl/sha.h

**é—®é¢˜æè¿°**ï¼š
```
fatal error: openssl/sha.h: No such file or directory
```

**è§£å†³æ–¹æ¡ˆ**ï¼š

```bash
# Ubuntu/Debian
sudo apt-get install libssl-dev

# CentOS/RHEL
sudo yum install openssl-devel

# macOS (ä½¿ç”¨ Homebrew)
brew install openssl
export CPATH=/usr/local/opt/openssl/include
export LIBRARY_PATH=/usr/local/opt/openssl/lib
```

### Q2: è¿è¡Œæ—¶æç¤º "usage: ./ttorrent metafile"

**é—®é¢˜æè¿°**ï¼šæ²¡æœ‰æä¾›ç§å­æ–‡ä»¶å‚æ•°

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ­£ç¡®çš„ä½¿ç”¨æ–¹å¼
./ttorrent your-file.torrent
```

### Q3: æ— æ³•è¿æ¥åˆ° Tracker

**å¯èƒ½åŸå› **ï¼š
1. ç½‘ç»œè¿æ¥é—®é¢˜
2. Tracker æœåŠ¡å™¨å·²å…³é—­
3. é˜²ç«å¢™é˜»æ­¢è¿æ¥

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥ç½‘ç»œè¿æ¥
2. å°è¯•ä½¿ç”¨å…¶ä»–ç§å­æ–‡ä»¶
3. æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

### Q4: ä¸‹è½½é€Ÿåº¦ä¸º 0

**å¯èƒ½åŸå› **ï¼š
1. æ²¡æœ‰å¯ç”¨çš„ Peer
2. æ‰€æœ‰ Peer éƒ½åœ¨é˜»å¡ä½ 
3. ç§å­æ–‡ä»¶è¿‡æ—§ï¼Œæ²¡æœ‰äººåœ¨åšç§

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç­‰å¾…æ›´å¤š Peer åŠ å…¥
2. å°è¯•å…¶ä»–çƒ­é—¨ç§å­
3. æ£€æŸ¥ç½‘ç»œ NAT è®¾ç½®

### Q5: å†…å­˜ä¸è¶³

**å¯èƒ½åŸå› **ï¼šç¨‹åºä½¿ç”¨ 16MB ç¼“å†²åŒº

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. å…³é—­å…¶ä»–ç¨‹åº
2. å¢åŠ ç³»ç»Ÿäº¤æ¢ç©ºé—´
3. ä¿®æ”¹ `data.c` ä¸­çš„ç¼“å†²åŒºå¤§å°ï¼ˆéœ€é‡æ–°ç¼–è¯‘ï¼‰

### Q6: ä¸‹è½½çš„æ–‡ä»¶æŸå

**å¯èƒ½åŸå› **ï¼š
1. ä¸‹è½½è¿‡ç¨‹ä¸­æ–­
2. ç£ç›˜ç©ºé—´ä¸è¶³
3. ç§å­æ–‡ä»¶æœ¬èº«æœ‰é—®é¢˜

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. åˆ é™¤æ–‡ä»¶å’Œä½å›¾ï¼Œé‡æ–°ä¸‹è½½
2. ä½¿ç”¨å…¶ä»– BT å®¢æˆ·ç«¯éªŒè¯ç§å­æ–‡ä»¶

### Q7: æƒé™è¢«æ‹’ç»

**é—®é¢˜æè¿°**ï¼š
```
Permission denied
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# ç»™ç¨‹åºæ·»åŠ æ‰§è¡Œæƒé™
chmod +x ttorrent

# æ£€æŸ¥ä¸‹è½½ç›®å½•æƒé™
ls -la .
```

---

## é¡¹ç›®ç»“æ„

```
yet-another-bt/
â”‚
â”œâ”€â”€ ğŸ“„ Makefile              # ç¼–è¯‘è„šæœ¬
â”œâ”€â”€ ğŸ“„ README.md             # é¡¹ç›®è¯´æ˜
â”œâ”€â”€ ğŸ“„ USAGE.md              # æœ¬ä½¿ç”¨æ–‡æ¡£
â”‚
â”œâ”€â”€ ğŸ“‚ æºä»£ç æ–‡ä»¶
â”‚   â”œâ”€â”€ main.c               # ç¨‹åºå…¥å£
â”‚   â”œâ”€â”€ parse_metafile.c/h   # ç§å­æ–‡ä»¶è§£æ
â”‚   â”œâ”€â”€ tracker.c/h          # Tracker é€šä¿¡
â”‚   â”œâ”€â”€ peer.c/h             # Peer ç®¡ç†
â”‚   â”œâ”€â”€ message.c/h          # æ¶ˆæ¯å¤„ç†
â”‚   â”œâ”€â”€ bitfield.c/h         # ä½å›¾æ“ä½œ
â”‚   â”œâ”€â”€ data.c/h             # æ•°æ®ç¼“å­˜
â”‚   â”œâ”€â”€ policy.c/h           # ä¸‹è½½ç­–ç•¥
â”‚   â”œâ”€â”€ torrent.c/h          # æ ¸å¿ƒæ§åˆ¶
â”‚   â”œâ”€â”€ bt_hash.c/h          # SHA1 å“ˆå¸Œ
â”‚   â”œâ”€â”€ signal_hander.c/h    # ä¿¡å·å¤„ç†
â”‚   â”œâ”€â”€ log.c/h              # æ—¥å¿—è®°å½•
â”‚   â””â”€â”€ bterror.c/h          # é”™è¯¯å¤„ç†
â”‚
â”œâ”€â”€ ğŸ“‚ backup/               # å¤‡ä»½æ–‡ä»¶
â”‚   â”œâ”€â”€ sha1.c               # å¤‡ç”¨ SHA1 å®ç°
â”‚   â””â”€â”€ sha1.h
â”‚
â””â”€â”€ ğŸ–¼ï¸ bt-structure.png      # æ¶æ„å›¾
```

---

## å¿«é€Ÿå‘½ä»¤å‚è€ƒ

| æ“ä½œ | å‘½ä»¤ |
|------|------|
| ç¼–è¯‘ | `make` |
| æ¸…ç† | `make clean` |
| è¿è¡Œ | `./ttorrent file.torrent` |
| åå°è¿è¡Œ | `nohup ./ttorrent file.torrent &` |
| åœæ­¢ | `Ctrl+C` æˆ– `kill <PID>` |
| åˆ é™¤è¿›åº¦ | `rm -f *_bitmap` |
| æŸ¥çœ‹è¿›ç¨‹ | `ps aux | grep ttorrent` |

---

## è”ç³»ä¸æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒé¡¹ç›®åŸå§‹ä»£ç æˆ–ã€ŠLinux Cç¼–ç¨‹å®æˆ˜ã€‹ä¸€ä¹¦ã€‚

---

**æœ€åæ›´æ–°**: 2025å¹´12æœˆ15æ—¥
